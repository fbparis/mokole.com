<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Visually Distinct Colors Generator</title>
		<link rel="stylesheet" href="https://unpkg.com/bulmaswatch/slate/bulmaswatch.min.css">
		<link rel="canonical" href="https://mokole.com/palette.html">
	</head>
	<body>
	<section class="section">
		<div class="container">
			<div class="columns">
				<div class="column">
					<h1 class="title">
						I want visually distinct colors!
					</h1>
					<p class="subtitle">
						Generate palettes of optimally distinct colors.
					</p>
				</div>
				<div class="column">
					<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
					<!-- Color-Tool-Mokole -->
					<ins class="adsbygoogle"
					     style="display:block"
					     data-ad-client="ca-pub-8237054068776864"
					     data-ad-slot="3759852311"
					     data-ad-format="auto"
					     data-full-width-responsive="true"></ins>
					<script>
					(adsbygoogle = window.adsbygoogle || []).push({});
					</script>
				</div>
			</div>
			<div class="columns">
				<div class="column is-7">
					<h4 class="title has-text-info is-4">How does it work?</h4>
					<hr>
					<p>Starting from a set including all <a href="https://www.w3.org/TR/css3-iccprof#x11-color">X11 colors</a>, the script will first remove darkest and brightest colors according to the values you have set for <em>minimum luminosity</em> and <em>maximum luminosity</em>.</p>
					<p>It will then build a subset of <em>n</em> colors where each color is visually the most distinct possible from every other colors in the set. For this, colors will be manipulated in the <a href="https://en.wikipedia.org/wiki/CIELAB_color_space">CIE Lab color space</a>, where the distance between colors is a perceptive distance (this means that if two colors values are close to each other, they will also look similar to you and if they are distant, they will be perceived as distinct colors).</p>
					<p>Resulting palettes are ranked according to the minimal pairwise distance between colors composing them, the greater the best so. This is the number shown on the left of the palettes. The number of remaining colors after filtering dark and bright colors is also shown, as the number of random palettes generated before returning the best one.</p>
				</div>
				<div class="column">
					<h4 class="title has-text-info is-4">Palette settings</h4>
					<hr>
					<form onsubmit="return submit_form();">
						<div class="field has-addons">
							<div class="control is-expanded">
								<input type="text" id="n" class="input" value="8" placeholder="How many colors do you need?">
								<p class="help">At least 2, more colors means less distinct they will be</p>
							</div>
							<div class="control">
								<a class="button is-static">
									colors
								</a>
							</div>
						</div>
						<div class="field has-addons">
							<div class="control is-expanded">
								<div class="select is-fullwidth">
									<select id="Lmin">
										<option value="0">Black is OK</option>
										<option value="1">1%</option>
										<option value="5" selected>5%</option>
										<option value="10">10%</option>
										<option value="15">15%</option>
										<option value="20">20%</option>
									</select>
								</div>
								<p class="help">You can exclude darker colors</p>
							</div>
							<div class="control">
								<a class="button is-static">
									minimum luminosity
								</a>
							</div>
						</div>
						<div class="field has-addons">
							<div class="control is-expanded">
								<div class="select is-fullwidth">
									<select id="Lmax">
										<option value="100">White is OK</option>
										<option value="99">99%</option>
										<option value="95">95%</option>
										<option value="90" selected>90%</option>
										<option value="85">85%</option>
										<option value="80">80%</option>
									</select>
								</div>
								<p class="help">You can exclude brighter colors</p>
							</div>
							<div class="control">
								<a class="button is-static">
									maximum luminosity
								</a>
							</div>
						</div>
						<div class="field has-addons">
							<div class="control is-expanded">
								<div class="select is-fullwidth">
									<select id="maxLoops">
										<option>1000</option>
										<option selected>5000</option>
										<option>10000</option>
										<option>15000</option>
									</select>
								</div>
								<p class="help">The more loops the better the results, but slower!</p>
							</div>
							<div class="control">
								<a class="button is-static">
									maximum loops
								</a>
							</div>
						</div>
						<div class="field">
							<div class="control is-expanded">
								<button id="submitButton" class="button is-fullwidth" type="submit">Make a palette with this settings</button>
							</div>
						</div>
					</form>	
				</div>
			</div>
		</div>
	</section>
	<section>
		<div class="container is-invisible" id="console">
		</div>
		<br>
		<div class="container" id="palettes">
		</div>
		<br>
	</section>
	<footer class="has-background-black">
		<div class="container content">
			<div class="columns">
				<div class="column is-4">
					<br>
					<p>
						<a class="twitter-share-button" href="https://twitter.com/intent/tweet?via=fbparis" rel="nofollow" data-size="large">Tweet</a>
					</p>
					<p>Thanks to: <a href="https://github.com/gka/chroma.js">Chroma.js</a>, <a href="https://bulma.io/">Bulma</a></p>
					<p>Developed by fbparis</p>
				</div>
				<div class="column is-8">
					<br>
					<p class="title has-text-info is-5 is-marginless">Why visually distinct colors?</p>
					<p class="is-size-6">There are many situations where you may need distinct colors palettes. For example if you're designing subway maps or if you want to replace letters by colors in an alphabet. It's also very useful to organize tags in a calendar or anything so that they are easily recognizable. Also, if you're a scientist or a statistician, this tool will help solving the problem of choosing colors for data visualization.</p>
				</div>
			</div>
		</div>
	</footer>
	<noscript>
		<div class="modal is-active">
			<div class="modal-background"></div>
			<div class="modal-content">
				<p class="notification is-danger has-text-centered has-text-weight-bold">JavaScript is required to run this page.</p>
			</div>
		</div>		
	</noscript>
	<div class="modal" id="browser-warning">
		<div class="modal-background"></div>
		<div class="modal-content">
			<p class="notification is-danger has-text-centered has-text-weight-bold">You need a <a href="https://caniuse.com/#feat=webworkers">modern browser supporting web workers</a> to run this page.</p>
		</div>
	</div>		
	</body>
	<script type="text/js-worker">
	"use strict";
	console.log("palette-worker: executing");
	importScripts("https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.4.0/chroma.min.js");

	function log(s) {
		postMessage(s);
	}

	function get_palette(n=8, Lmin=5, Lmax=90, maxLoops=10000) {
		log("processing with parameters n=" + n + ", Lmin=" + Lmin + ", Lmax=" + Lmax + ", maxLoops=" + maxLoops);
		var data = new Array();
		for (var color in chroma.colors) {
			var c = chroma(color);
			var L = 100 * c.hsl()[2];
			if ((L >= Lmin) && (L <= Lmax)) {
				data.push(c);
			}
		}
		log(data.length + " initial colors");
		var bestScore = 0;
		var bestPalette = null;
		var generation = 0;
		var loop = 0;
		while (loop < maxLoops) {
			loop += 1;
			var colors = data.slice(0);
			var palette = colors.splice(Math.floor(Math.random() * colors.length), 1);
			while (palette.length < n) {
				var availableColors = new Array();
				colors.forEach(function (color) {
					var accepted = true;
					for (var k in palette) {
						if (chroma.distance(color, palette[k]) <= bestScore) {
							accepted = false;
							break;
						}
					}
					if (accepted) {
						availableColors.push(color);
					}
				});
				if (availableColors.length < n - palette.length) {
					break;
				}
				palette = palette.concat(availableColors.splice(Math.floor(Math.random() * availableColors.length), 1));
				colors = availableColors.slice(0);
			}
			if (palette.length == n) {
				generation += loop;
				loop = 0;
				bestScore = null;
				for (var i = 0; i < n - 1; i++) {
					for (var j = i + 1; j < n; j++) {
						var d = chroma.distance(palette[i], palette[j]);
						if ((bestScore === null) || (d < bestScore)) {
							bestScore = d;
						}
					}
				}
				bestPalette = palette.slice(0);
				log("generation " + generation + ": better palette found with score " + bestScore);
			}
		}
		log(generation + loop + " loops done");
		bestPalette.sort(function (a, b) {
			var score_a = (a.hsl()[0] !== a.hsl()[0] ? -8 : a.hsl()[0] / 360) + a.hsl()[1] * 2 + a.hsl()[2] * 5;
			var score_b = (b.hsl()[0] !== b.hsl()[0] ? -8 : b.hsl()[0] / 360) + b.hsl()[1] * 2 + b.hsl()[2] * 5;
			return score_a - score_b;
		});
		generation += loop;
		var score = Math.round(bestScore * 100) / 100;
		var innerHTML = '<div class="media-left"><p class="is-size-2 has-text-warning">' + score + '</p><p class="is-size-7">' + data.length + ' colors</p><p class="is-size-7">' + generation + ' loops</p></div><div class="media-content">';
		bestPalette.forEach(function (color) {
			var textColor = chroma.distance(color, chroma("black"), "lab") > 1.2 * chroma.distance(color, chroma("white"), "lab") ? "black" : "white";
			innerHTML += '<div class="is-pulled-left box is-radiusless has-text-' + textColor + ' has-text-weight-bold has-text-centered" style="background-color: ' + color.hex() + '"><p>' + color.name() + '</p><p>' + color.hex() + '</p></div>';
			});
		innerHTML += '</div><div class="media-right"><button class="delete" onclick="remove_palette(this)"></button></div>';
		return {"total_colors": data.length, "loops_done": generation, "score": score, "palette": bestPalette, "paletteHTML": innerHTML};	
	}

	onmessage = function (e) {
		var n, Lmin, Lmax, maxLoops;
		[n, Lmin, Lmax, maxLoops] = e.data;
		var R = get_palette(n, Lmin, Lmax, maxLoops);
		postMessage(R);
	}		
	</script>
	<script type="text/javascript">
	if (window.Worker) {
		var blob = new Blob(Array.prototype.map.call(document.querySelectorAll('script[type=\'text\/js-worker\']'), function (oScript) { return oScript.textContent; }),{type: 'text/javascript'});
		var worker = new Worker(window.URL.createObjectURL(blob));
		worker.onmessage = function (e) {
			R = e.data;
			if (typeof R == "string") {
				document.getElementById("console").innerHTML = '<pre class="notification box is-primary has-text-success has-text-centered">' + R + '</pre>';
			} else {
				if (R["palette"] !== null) {
					palettes = document.getElementById("palettes");
					newPalette = document.createElement("div");
					newPalette.className = "media box";
					newPalette.innerHTML = R["paletteHTML"];
					palettes.insertBefore(newPalette, palettes.firstChild);
				}
				document.getElementById("console").classList.add("is-invisible");			
				document.getElementById("submitButton").classList.remove("is-loading");			
			}
		}
	} else {
		document.getElementById("browser-warning").classList.add("is-active");		
	}

	function remove_palette(b) {
		b.parentNode.parentNode.parentNode.removeChild(b.parentNode.parentNode);
	}

	function submit_form() {
			b = document.getElementById("submitButton");
			if (!b.classList.contains("is-loading")) {
				b.classList.add("is-loading");
				document.getElementById("console").classList.remove("is-invisible");
				n = document.getElementById("n").value;
				Lmin = document.getElementById("Lmin").value;
				Lmax = document.getElementById("Lmax").value;
				maxLoops = document.getElementById("maxLoops").value;
				worker.postMessage([n, Lmin, Lmax, maxLoops]);			
			}
			return false;
	}
	</script>
	<script>
		window.twttr = (function(d, s, id) {
	  var js, fjs = d.getElementsByTagName(s)[0],
	    t = window.twttr || {};
	  if (d.getElementById(id)) return t;
	  js = d.createElement(s);
	  js.id = id;
	  js.src = "https://platform.twitter.com/widgets.js";
	  fjs.parentNode.insertBefore(js, fjs);

	  t._e = [];
	  t.ready = function(f) {
	    t._e.push(f);
	  };
	  return t;
	}(document, "script", "twitter-wjs"));
	</script>
</html>
